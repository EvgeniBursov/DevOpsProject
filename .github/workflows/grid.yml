name: Selenium Test Grid

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest

    services:
        selenium-hub:
          image: selenium/hub:latest
          ports:
            - 4444:4444

        chrome:
          image: selenium/node-chrome:latest
          depends_on:
            - selenium-hub
          environment:
            HUB_HOST: selenium-hub
          ports:
            - 5555:5555

        firefox:
          image: selenium/node-firefox:latest
          depends_on:
            - selenium-hub
          environment:
            HUB_HOST: selenium-hub
          ports:
            - 5556:5556

        edge:
          image: selenium/node-edge:latest
          depends_on:
            - selenium-hub
          environment:
            HUB_HOST: selenium-hub
          ports:
            - 5557:5557

    steps:
    - name: Checkout repository
      uses: actions/checkout@v2

    - name: Install Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '14'

    - name: Install dependencies
      run: npm install selenium-webdriver

    - name: Run tests
      run: node tests/seleniumGrid/test.js

    - name: Tear down Selenium Grid
      run: docker stop selenium-hub