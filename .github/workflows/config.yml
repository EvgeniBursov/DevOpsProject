name: Selenium Tests

on: [push]

jobs:
  test:
    runs-on: ubuntu-latest

    services:
      selenium-hub:
        image: selenium/hub:latest
        ports:
          - 4444:4444
        volumes:
          - ./selenium-server-4.18.1.jar:/selenium-server.jar  # Mount selenium-server-4.18.1.jar from the host
        command: java -jar /selenium-server.jar -port 4444  # Custom command to start Selenium Server

      firefox-node:
        image: selenium/node-firefox:latest
        depends_on:
          - selenium-hub
        environment:
          - HUB_HOST=selenium-hub
          - HUB_PORT=4444
        volumes:
          - /dev/shm:/dev/shm

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Check Docker containers
        run: docker ps

      - name: Install Node.js
        uses: actions/setup-node@v2
        with:
          node-version: '14'

      - name: Install dependencies
        run: npm install selenium-webdriver

      - name: Verify Selenium Server is Running
        run: |
          docker exec selenium-hub ps aux | grep 'selenium-server.jar'

      - name: Run tests
        run: node tests/seleniumGrid/test.js

      - name: Tear down Selenium Grid
        run: docker stop selenium-hub
