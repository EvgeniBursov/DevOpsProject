<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Web Store</title>
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <link rel="stylesheet" href="../css/home.css">
</head>

<body>
    <nav class="navbar"></nav>

    <!-- hero section -->
    <header class="hero-section">
        <div class="content">
            <img src="../img/light-logo.png" class="logo" alt="">
            <p class="sub-heading">best web store of all time</p>
        </div>
    </header>
     <!-- hero section -->
     <section class="product">
        <h2 class="product-category">Products</h2>
        <button class="pre-btn"><img src="../img/arrow.png" alt=""></button>
        <button class="nxt-btn"><img src="../img/arrow.png" alt=""></button>
        <div class="product-container">
            <div class="product-card">
                <div class="product-image">
                    <img src="../img/card1.png" class="product-thumb" alt="">
                    <button class="card-btn" id="card-btn1">add to card</button>
                </div>
                <div class="product-info">
                    <h2 class="product-brand" id="brand a">brand a</h2>
                    <p class="product-short-des">green drees</p>
                    <span class="price"></span><span class="actual-price">$240</span>
                </div>
            </div>

            <div class="product-card">
                <div class="product-image">
                    <img src="../img/card2.png" class="product-thumb" alt="">
                    <button class="card-btn" id="card-btn2">add to card</button>
                </div>
                <div class="product-info">
                    <h2 class="product-brand">brand B</h2>
                    <p class="product-short-des">white jeans </p>
                    <span class="price"></span><span class="actual-price">$100</span>
                </div>
            </div>

            <div class="product-card">
                <div class="product-image">
                    <span class="discount-tag"></span>
                    <img src="../img/card3.png" class="product-thumb" alt="">
                    <button class="card-btn"  id="card-btn3" >add to card</button>
                </div>
                <div class="product-info">
                    <h2 class="product-brand">brand C</h2>
                    <p class="product-short-des">Sport cloth</p>
                    <span class="price"></span><span class="actual-price">$440</span>
                </div>
            </div>

            <div class="product-card">
                <div class="product-image">
                    <span class="discount-tag"></span>
                    <img src="../img/card4.png" class="product-thumb" alt="">
                    <button class="card-btn" id="card-btn4">add to card</button>
                </div>
                <div class="product-info">
                    <h2 class="product-brand">brand D</h2>
                    <p class="product-short-des">pink drees</p>
                    <span class="price"></span><span class="actual-price">$330</span>
                </div>
            </div>

            <div class="product-card">
                <div class="product-image">
                    <span class="discount-tag"></span>
                    <img src="../img/card5.png" class="product-thumb" alt="">
                    <button class="card-btn" id="card-btn5">add to card</button>
                </div>
                <div class="product-info">
                    <h2 class="product-brand">brand E</h2>
                    <p class="product-short-des">black chinese style</p>
                    <span class="price"></span><span class="actual-price">$420</span>
                </div>
            </div>

            <div class="product-card">
                <div class="product-image">
                    <span class="discount-tag"></span>
                    <img src="../img/card6.png" class="product-thumb" alt="">
                    <button class="card-btn" id="card-btn6">add to card</button>
                </div>
                <div class="product-info">
                    <h2 class="product-brand">brand F</h2>
                    <p class="product-short-des">black watch</p>
                    <span class="price"></span><span class="actual-price">$840</span>
                </div>
            </div>
            
            <div class="product-card">
                <div class="product-image">
                    <span class="discount-tag"></span>
                    <img src="../img/card7.png" class="product-thumb" alt="">
                    <button class="card-btn" id="card-btn7">add to card</button>
                </div>
                <div class="product-info">
                    <h2 class="product-brand">brand G</h2>
                    <p class="product-short-des">grey pants</p>
                    <span class="price"></span><span class="actual-price">$140</span>
                </div>
            </div>
            <div class="product-card">
                <div class="product-image">
                    <span class="discount-tag"></span>
                    <img src="../img/card8.png" class="product-thumb" alt="">
                    <button class="card-btn" id="card-btn8">add to card</button>
                </div>
                <div class="product-info">
                    <h2 class="product-brand">brand H</h2>
                    <p class="product-short-des">black shoes</p>
                    <span class="price"></span><span class="actual-price">$340</span>
                </div>
            </div>
            <div class="product-card">
                <div class="product-image">
                    <span class="discount-tag"></span>
                    <img src="../img/card9.png" class="product-thumb" alt="">
                    <button class="card-btn" id="card-btn9">add to card</button>
                </div>
                <div class="product-info">
                    <h2 class="product-brand">brand I</h2>
                    <p class="product-short-des">black shike shoes</p>
                    <span class="price"></span><span class="actual-price">$60</span>
                </div>
            </div>
            <div class="product-card">
                <div class="product-image">
                    <span class="discount-tag"></span>
                    <img src="../img/card10.png" class="product-thumb" alt="">
                    <button class="card-btn" id="card-btn10">add to card</button>
                </div>
                <div class="product-info">
                    <h2 class="product-brand">brand K</h2>
                    <p class="product-short-des">blue shoes</p>
                    <span class="price"></span><span class="actual-price">$250</span>
                </div>
            </div>
            <div class="product-card">
                <div class="product-image">
                    <span class="discount-tag"></span>
                    <img src="../img/card11.png" class="product-thumb" alt="">
                    <button class="card-btn" id="card-btn11">add to card</button>
                </div>
                <div class="product-info">
                    <h2 class="product-brand">brand L</h2>
                    <p class="product-short-des">grey shoes</p>
                    <span class="price"></span><span class="actual-price">$355</span>
                </div>
            </div>
            <div class="product-card">
                <div class="product-image">
                    <span class="discount-tag"></span>
                    <img src="../img/card12.png" class="product-thumb" alt="">
                    <button class="card-btn" id="card-btn12">add to card</button>
                </div>
                <div class="product-info">
                    <h2 class="product-brand">brand N</h2>
                    <p class="product-short-des">black&white shoes</p>
                    <span class="price"></span><span class="actual-price">$555</span>
                </div>
            </div>

            <!-- more cards -->
        </div>
    </section>

    <!-- collections -->
    <section class="collection-container">
        <a href="#" class="collection">
            <img src="../img/women-collection.png" alt="">
            <p class="collection-title">women <br> apparels</p>
        </a>
        <a href="#" class="collection">
            <img src="../img/men-collection.png" alt="">
            <p class="collection-title">men <br> apparels</p>
        </a>
        <a href="#" class="collection">
            <img src="../img/accessories-collection.png" alt="">
            <p class="collection-title">accessories</p>
        </a>
    </section>

    <!-- footer -->
    <footer></footer>


    <script src="../js/nav.js"></script>
    <script src="../js/home.js"></script>
    <script src="../js/footer.js"></script>
</body>
<script>
    let buttons = document.querySelectorAll('.card-btn');
    let cartCount = document.getElementById('cart-count')
    let total = document.getElementById('total') 
    let buyBtn = document.querySelector('.buy_btn');
    let productsData = []
    let localproducts = JSON.parse(localStorage.getItem('product')) || []

    buttons.forEach((button, index) => {
        button.addEventListener('click', () => {

            const userData = checkUserLoggedIn();
            const productCard = button.closest('.product-card');
            const brand = productCard.querySelector('.product-brand').innerText;
            const shortDescription = productCard.querySelector('.product-short-des').innerText;
            const price = productCard.querySelector('.price').innerText;
            const actualPrice = productCard.querySelector('.actual-price').innerText;

            if(userData){
                const product = {
                    product_name: brand,
                    user_id: userData._id,
                    user_email: userData.email,
                    product_id: index + 1,
                    product_des: shortDescription,
                    product_price: parseFloat(actualPrice.replace('$', '')),
                };
                console.log(product)
                //productsData.push(product);
                //NEW
                localproducts = JSON.parse(localStorage.setItem(product.product_name, product.product_des, product.product_price)) 
                localproducts.push(product)
                console.log(localproducts)

                updateCartCount(1);
                updateCartPopup();
                
                //const productsJSON = JSON.stringify(productsData);
                //console.log(productsJSON);
            }else{
                alert("Please Login in system")
            }
            
        });
    });

function updateCartCount(num) {
    cartCount.textContent = parseInt(cartCount.textContent) + num;
}

function checkUserLoggedIn() {
    const userDataString = sessionStorage.getItem('user');
    if(userDataString) {
        return JSON.parse(userDataString);
    } else {
        return null;
    }
}


/*function updateCartPopup() {
    let cartPopup = document.querySelector('.cart-popup');
    let cartItemsList = document.querySelector('.cart-items-list');
    let cartTotal = document.getElementById('total');

    let totalPrice = 0
    cartItemsList.innerHTML = '';
    productsData.forEach((product,index) => {
        const itemHTML = `
            <li>
                <div>
                    <p><strong>${product.product_name} - ${product.product_des}</strong><button class="minusBtn" onclick="decrementCount(${index})">X</button></p>
                    <p><h3>Price: ${product.product_price}$</h3></p>
                </div>
            </li>
        `;
        cartItemsList.insertAdjacentHTML('beforeend', itemHTML);
        totalPrice += product.product_price
    });
    total.textContent = parseInt(totalPrice)
}*/


function updateCartPopup() {
    let cartPopup = document.querySelector('.cart-popup');
    let cartItemsList = document.querySelector('.cart-items-list');
    let cartTotal = document.getElementById('total');

    let totalPrice = 0
    cartItemsList.innerHTML = '';
    localproducts.forEach((product,index) => {
        const itemHTML = `
            <li>
                <div>
                    <p><strong>${product.product_name} - ${product.product_des}</strong><button class="minusBtn" onclick="decrementCount(${index})">X</button></p>
                    <p><h3>Price: ${product.product_price}$</h3></p>
                </div>
            </li>
        `;
        cartItemsList.insertAdjacentHTML('beforeend', itemHTML);
        totalPrice += product.product_price
    });
    total.textContent = parseInt(totalPrice)
}




function incrementCount(index) {
    let countElement = document.getElementById(`count`);
    let count = parseInt(countElement.textContent);
    count++;
    countElement.textContent = count;
    //productsData.splice(index, 1);
    localproducts.splice(index, 1);
    updateCartPopup(); 
}

function decrementCount(index) {
    if(index!=0){
        //productsData.splice(index, 1);
        localproducts.splice(index, 1);
        updateCartCount(-1)
        updateCartPopup(); 
    }
}

buyBtn.addEventListener('click', async () => {
    const userData = checkUserLoggedIn();
    if (userData && localproducts.length > 0) {
        cartPop.classList.toggle('hide')
        window.location.href = '../pages/thankPage.html'
        //productsData = []
    }else{
        alert("Please Login in system or add products")
    }

    //sendData('/end', productsData)
    //updateProductsJSON();
    //sendData('/end', productsData)
    //console.log("from btn:",productsData,"**********",productsJSON)
})

//new one end 
/*const sendData = (path, data) => {
    console.log(path, data);  
    fetch(path, {
        method: "POST", 
        mode: "cors", 
        headers: {
            "Content-Type": "application/json",
        },
        body: data,
    })
    .then((res) => res.json())
    .then(response => {
        processData(response);
    })
    .catch(error => {
        console.error('Error:', error);
        loader.style.display = null;
        showAlert('An error occurred while sending data.');
    });
}*/


/*function updateProductsJSON() {
    productsJSON = JSON.stringify(productsData);
}*/

</script>


